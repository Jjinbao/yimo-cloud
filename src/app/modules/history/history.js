angular.module('ymy.history',[])
    .controller('historyRecord',['$scope','$state','$ionicViewSwitcher',function($scope,$state,$ionicViewSwitcher){
        $scope.$on('$ionicView.beforeEnter',function(){
            $scope.hideTabBar('hide');
        })
        $scope.toPart=function(val){
            if(val=='应用'){
                $state.go('application',{});
            }else if(val=='资讯'){
                $state.go('infoMsg',{});
            }else if(val=='教学'){
                $state.go('teaching',{});
            }
            $ionicViewSwitcher.nextDirection('forward');
        }

    }])
    .controller('application',['$scope','$state','$http','$ionicViewSwitcher','userService',function($scope,$state,$http,$ionicViewSwitcher,userService){
        $scope.appList='';
        $http({
            url:urlStr+'ym/history/list.api',
            method:'POST',
            params:{
                accountId:userService.userMess.accountId,
                type:'app',
                sign:md5('ymy'+userService.userMess.accountId+'app')
            }
        }).success(function(data){
            if(data.result==1){
                $scope.appList=data.list;
            }
        })
    }])
    .controller('teaching',['$scope','$state','$http','$ionicViewSwitcher','userService',function($scope,$state,$http,$ionicViewSwitcher,userService){
        $scope.panelType;
        $scope.teachInfo=[];
        $scope.getTeachHistory=function(val){
            $http({
                url:urlStr+'ym/history/list.api',
                method:'POST',
                params:{
                    accountId:userService.userMess.accountId,
                    type:'teach',
                    categoryId:val,
                    sign:md5('ymy'+userService.userMess.accountId+'teach')
                }
            }).success(function(data){
                if(data.result==1){
                    $scope.teachInfo=data.list;
                }
            })
        }

        $scope.teachChoice=function(val){
            if($scope.panelType==val){
                return;
            }
            $scope.panelType=val;
            if($scope.panelType=='sp'){
                $scope.getTeachHistory(1);
            }else{
                $scope.getTeachHistory(2);
            }
        }

        $scope.teachChoice('sp');

        $scope.toTeachVideo=function(val){
            $state.go('videoDetail',{rootId:1,id:val.teach.id,vsrc:val.teach.videoSrc});
            $ionicViewSwitcher.nextDirection('forward');
        }

        $scope.toTwInfoDetail=function(val){
            $state.go('infoDetail',{rootId:9,id:val.news.id});
            $ionicViewSwitcher.nextDirection('forward');
        }
    }])
    .controller('information',['$scope','$state','$http','$ionicViewSwitcher','userService',function($scope,$state,$http,$ionicViewSwitcher,userService){
        $scope.infoList=[];
        $http({
            url:urlStr+'ym/history/list.api',
            method:'POST',
            params:{
                accountId:userService.userMess.accountId,
                type:'news',
                sign:md5('ymy'+userService.userMess.accountId+'news')
            }
        }).success(function(data){
            if(data.result==1){
                $scope.infoList=data.list;
            }
        })

        $scope.toInfoDetail=function(val){
            $state.go('infoDetail',{rootId:9,id:val.news.id});
            $ionicViewSwitcher.nextDirection('forward');
        }
    }])
